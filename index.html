// ... dentro de <script type="text/babel">

    // --- Componente 1: Grilla de Horarios y Reserva ---

    const HorariosReservas = ({ goToScreen }) => {
// ...
        const fetchClases = useCallback(async () => {
            try {
                const response = await fetch(`${API_BASE_URL}/clases`);
                if (!response.ok) throw new Error('Error al cargar clases');
                const data = await response.json();
                
                // Agrupar clases por día para la visualización en cuadrícula
                const grouped = data.reduce((acc, clase) => {
                    // **CORRECCIÓN 1: Manejar el día con trim() para eliminar espacios en blanco (ej. 'sábado ')**
                    const diaKey = clase.dia.trim().charAt(0).toUpperCase() + clase.dia.trim().slice(1);
                    if (!acc[diaKey]) {
                        acc[diaKey] = [];
                    }
                    acc[diaKey].push(clase);
                    return acc;
                }, {});
                
                // Ordenar días de la semana
                const orderedDays = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
// ...
                setClases(sortedGrouped);
            } catch (error) {
                console.error(error);
                setMessage('Error al cargar los horarios.');
                setMessageType('error');
            }
        }, []);

// ...
        
        const renderClaseBox = (clase) => {
            const isSelected = clasesSeleccionadas.includes(clase.id_clase);
            
            // **CORRECCIÓN 2: Obtener la capacidad máxima de la clase, no hardcodear 6.**
            const capacidad = clase.capacidad; 
            const inscriptos = clase.inscriptos;
            
            const isFull = inscriptos >= capacidad;
            const isLastSpot = inscriptos === capacidad - 1;

            let bgColor = 'bg-card-bg';
// ...
            
            const handleClick = () => {
                if (!isFull) {
                    toggleSeleccion(clase.id_clase);
                } else {
                    // **CORRECCIÓN 3: Usar la capacidad variable en el mensaje de error**
                    setMessage(`La clase de ${clase.clase} a las ${clase.hora.slice(0, 5)} está completa (${inscriptos}/${capacidad}).`);
                    setMessageType('warning');
                }
            };
            
            return (
// ...
                    <p className="text-sm">{clase.hora.slice(0, 5)}</p>
                    <p className={`text-xs mt-1 font-semibold ${isFull ? 'text-red-700' : isLastSpot ? 'text-yellow-700' : 'text-gray-700'}`}>
                        {/* **CORRECCIÓN 4: Usar la capacidad variable en el mensaje de cupos** */}
                        {isFull ? 'COMPLETA' : `Cupos: ${inscriptos}/${capacidad}`}
                    </p>
                </div>
            );
        };
        
// ...
        return (
// ...
                            <p className="text-center text-sm text-gray-500 mt-4">
                                {/* **CORRECCIÓN 5: Usar capacidad variable en el texto explicativo** */}
                                <span className="text-red-600 font-bold">Rojo/Tachado</span>: Clase Completa | <span className="text-yellow-600 font-bold">Amarillo</span>: Último Cupo Disponible ({6-1}/6).
                            </p>
                        </React.Fragment>
// ...
